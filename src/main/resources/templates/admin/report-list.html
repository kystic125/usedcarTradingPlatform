<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>신고 관리 - 관리자</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark mb-4">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/admin">SmartPick ADMIN</a>
        <div>
            <a href="/admin/vehicles" class="btn btn-outline-light btn-sm me-2">매물 관리</a>
            <a href="/admin/settlements" class="btn btn-outline-light btn-sm me-2">정산 관리</a>
            <a href="/admin/reports" class="btn btn-light btn-sm fw-bold">신고 관리</a>
        </div>
    </div>
</nav>

<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold"><i class="bi bi-exclamation-triangle-fill me-2 text-danger"></i> 신고 관리</h2>
    </div>

    <ul class="nav nav-tabs mb-4">
        <li class="nav-item">
            <a class="nav-link" th:classappend="${currentStatus.name() == 'PENDING'} ? 'active fw-bold'"
               href="/admin/reports?status=PENDING">
                대기중 <span class="badge bg-danger ms-1" th:text="${pendingCount}">0</span>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" th:classappend="${currentStatus.name() == 'RESOLVED'} ? 'active fw-bold'"
               href="/admin/reports?status=RESOLVED">처리 완료</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" th:classappend="${currentStatus.name() == 'REJECTED'} ? 'active fw-bold'"
               href="/admin/reports?status=REJECTED">반려됨</a>
        </li>
    </ul>

    <div class="card shadow-sm">
        <div class="card-body p-0">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                <tr>
                    <th class="ps-4">ID</th>
                    <th>유형</th>
                    <th>대상 ID</th>
                    <th>신고자</th>
                    <th>신고 사유</th>
                    <th>신고일</th>
                    <th class="text-end pe-4">관리</th>
                </tr>
                </thead>
                <tbody>
                <tr th:if="${#lists.isEmpty(reports)}">
                    <td colspan="7" class="text-center py-5 text-muted">해당 상태의 신고 내역이 없습니다.</td>
                </tr>

                <tr th:each="rpt : ${reports}">
                    <td class="ps-4" th:text="${rpt.reportId}">1</td>
                    <td>
                        <span class="badge bg-secondary" th:text="${rpt.reportType}">VEHICLE</span>
                    </td>
                    <td>
                        <a th:if="${rpt.reportType.name() == 'VEHICLE'}"
                           th:href="@{/vehicles/{id}(id=${rpt.targetId})}" target="_blank"
                           class="text-decoration-none fw-bold text-dark">
                            <i class="bi bi-box-arrow-up-right me-1"></i>[[${rpt.targetId}]]
                        </a>
                        <span th:unless="${rpt.reportType.name() == 'VEHICLE'}" th:text="${rpt.targetId}"></span>
                    </td>
                    <td th:text="${rpt.reporter.name} + ' (' + ${rpt.reporter.email} + ')'">홍길동</td>
                    <td class="text-truncate" style="max-width: 300px;"
                        th:title="${rpt.description}" th:text="${rpt.description}">사유 내용...</td>
                    <td th:text="${#temporals.format(rpt.createdAt, 'yyyy-MM-dd HH:mm')}">2024-01-01</td>

                    <td class="text-end pe-4">
                        <div th:if="${rpt.reportStatus.name() == 'PENDING'}" class="d-flex gap-2 justify-content-end">
                            <form th:action="@{/admin/reports/{id}/resolve(id=${rpt.reportId})}" method="post">
                                <button class="btn btn-sm btn-danger fw-bold"
                                        onclick="return confirm('신고를 승인하고 제재 처리하시겠습니까?')">
                                    승인 (제재)
                                </button>
                            </form>

                            <form th:action="@{/admin/reports/{id}/reject(id=${rpt.reportId})}" method="post">
                                <button class="btn btn-sm btn-secondary fw-bold"
                                        onclick="return confirm('신고를 반려하시겠습니까? (제재 없음)')">
                                    반려
                                </button>
                            </form>
                        </div>

                        <div th:unless="${rpt.reportStatus.name() == 'PENDING'}">
                            <span class="badge bg-success" th:if="${rpt.reportStatus.name() == 'RESOLVED'}">처리됨</span>
                            <span class="badge bg-secondary" th:if="${rpt.reportStatus.name() == 'REJECTED'}">반려됨</span>
                            <br>
                            <small class="text-muted" th:if="${rpt.handler != null}"
                                   th:text="'by ' + ${rpt.handler.name}">by Admin</small>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

</body>
</html>