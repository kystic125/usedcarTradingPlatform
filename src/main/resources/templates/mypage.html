<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>마이페이지 - 스마트픽</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark mb-4">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/">SmartPick 🚗</a>
        <a href="/logout" class="btn btn-danger btn-sm">로그아웃</a>
    </div>
</nav>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <h2 class="mb-4 fw-bold text-center">마이페이지</h2>

            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white fw-bold d-flex justify-content-between align-items-center">
                    <span>👤 내 정보</span>
                    <a href="/mypage/edit" class="btn btn-sm btn-outline-primary">정보 수정</a>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <label class="col-sm-3 col-form-label text-secondary">이름</label>
                        <div class="col-sm-9">
                            <input type="text" readonly class="form-control-plaintext fw-bold" th:value="${user.name}">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label class="col-sm-3 col-form-label text-secondary">이메일</label>
                        <div class="col-sm-9">
                            <input type="text" readonly class="form-control-plaintext" th:value="${user.email}">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label class="col-sm-3 col-form-label text-secondary">전화번호</label>
                        <div class="col-sm-9">
                            <input type="text" readonly class="form-control-plaintext" th:value="${user.phone}">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label class="col-sm-3 col-form-label text-secondary">회원 유형</label>
                        <div class="col-sm-9">
                            <span th:if="${user.role.name() == 'CUSTOMER'}" class="badge bg-primary">일반 회원 (구매자)</span>
                            <span th:if="${user.role.name() == 'COMPANY_OWNER'}" class="badge bg-dark">기업 회원 (대표)</span>
                            <span th:if="${user.role.name() == 'COMPANY_EMPLOYEE'}" class="badge bg-warning text-dark">기업 회원 (직원)</span>
                            <span th:if="${user.role.name() == 'ADMIN'}" class="badge bg-danger">관리자</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow-sm mb-4 border-primary" th:if="${user.role.name() == 'CUSTOMER'}">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="fw-bold mb-1">💼 사장님이신가요?</h5>
                        <p class="text-muted mb-0 small">업체 정보를 등록하고 차량 판매를 시작해보세요.</p>
                    </div>
                    <a href="/company/register" class="btn btn-primary fw-bold">판매자<br></br>등록하기</a>
                </div>
            </div>

            <div class="card shadow-sm mb-4" th:if="${user.provider.name() == 'LOCAL' and user.role.name() != 'ADMIN'}">
                <div class="card-header bg-white fw-bold">
                    🔗 계정 연동
                </div>
                <div class="card-body d-flex justify-content-between align-items-center">

                    <div th:if="${user.providerId != null}" class="d-flex w-100 justify-content-between align-items-center">
                        <div>
                            <h6 class="fw-bold text-success mb-1">✅ 카카오 계정과 연결됨</h6>
                            <p class="text-muted mb-0 small">카카오톡 아이디로 로그인할 수 있습니다.</p>
                        </div>
                        <form action="/auth/unlink" method="post" onsubmit="return confirm('연동을 해제하시겠습니까?');">
                            <button type="submit" class="btn btn-outline-secondary btn-sm">연동 해제</button>
                        </form>
                    </div>

                    <div th:if="${user.providerId == null}" class="d-flex w-100 justify-content-between align-items-center">
                        <div>
                            <h6 class="fw-bold text-dark mb-1">카카오 계정 연결하기</h6>
                            <p class="text-muted mb-0 small">연결하면 카카오톡으로도 로그인할 수 있습니다.</p>
                        </div>
                        <a href="/oauth2/authorization/kakao" class="btn btn-warning text-dark fw-bold btn-sm">
                            <img src="https://developers.kakao.com/assets/img/about/logos/kakaolink/kakaolink_btn_small.png" width="20"/>
                            연동하기
                        </a>
                    </div>

                </div>
            </div>

            <div class="card shadow-sm mb-4 border-warning" sec:authorize="hasAnyRole('COMPANY_OWNER', 'COMPANY_EMPLOYEE')">
                <div class="card-header bg-warning bg-opacity-10 fw-bold text-dark">
                    🏢 판매자 메뉴
                </div>
                <div class="card-body">
                    <p class="card-text">판매 차량을 등록하거나 관리할 수 있습니다.</p>
                    <div class="d-grid gap-2 d-md-block">
                        <a href="/company/sales" class="btn btn-warning">내 차량 관리</a>
                        <a href="/vehicles/register" class="btn btn-outline-dark">차량 등록하기</a>
                        <a href="/company/employees" class="btn btn-outline-secondary" sec:authorize="hasRole('COMPANY_OWNER')">직원 관리</a>
                    </div>
                </div>
            </div>

            <div class="text-center mt-4 d-flex justify-content-center">
                <a href="/" class="btn btn-secondary me-2">홈으로 돌아가기</a>

                <form th:unless="${user.role.name() == 'COMPANY_EMPLOYEE' or user.role.name() == 'ADMIN'}"
                      action="/auth/withdraw" method="post"
                      onsubmit="return confirm('정말로 탈퇴하시겠습니까? 모든 정보가 삭제됩니다.');">
                    <button type="submit" class="btn btn-outline-danger">회원 탈퇴</button>
                </form>
            </div>
        </div>
    </div>
</div>

</body>
</html>