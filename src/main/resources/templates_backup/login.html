<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>로그인 - 스마트픽</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5" style="max-width: 400px;">
    <h2 class="text-center mb-4">로그인</h2>

    <form action="/login" method="post" class="card p-4 shadow-sm">
        <div th:if="${param.error}" class="alert alert-danger">
            이메일 또는 비밀번호가 틀렸습니다.
        </div>

        <div class="mb-3">
            <label class="form-label">이메일</label>
            <input type="email" name="email" class="form-control" placeholder="name@example.com" required>
        </div>
        <div class="mb-3">
            <label class="form-label">비밀번호</label>
            <input type="password" name="password" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">로그인</button>
    </form>

    <div class="text-center my-3">또는</div>

    <a href="/oauth2/authorization/kakao" class="btn btn-warning w-100 text-dark fw-bold">
        카카오 로그인
    </a>

    <div class="text-center mt-3">
        <a href="/signup">계정이 없으신가요? 회원가입</a> | <a href="/">홈으로</a>
    </div>
</div>

<div id="loadingOverlay" class="d-none position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center"
     style="background: rgba(255, 255, 255, 0.8); z-index: 9999;">
    <div class="text-center">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3 fw-bold text-dark">로그인 처리 중입니다...</p>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // 1. 일반 로그인 폼 제출 시 로딩화면 켜기
    document.querySelector('form').addEventListener('submit', function() {
        document.getElementById('loadingOverlay').classList.remove('d-none');
    });

    // 2. 카카오 로그인 버튼 클릭 시 로딩화면 켜기
    const kakaoBtn = document.querySelector('a[href*="kakao"]');
    if (kakaoBtn) {
        kakaoBtn.addEventListener('click', function() {
            document.getElementById('loadingOverlay').classList.remove('d-none');
        });
    }

    // 3. 브라우저 뒤로가기 했을 때 로딩화면 끄기
    window.onpageshow = function(event) {
        if (event.persisted) {
            document.getElementById('loadingOverlay').classList.add('d-none');
        }
    };
</script>
</body>
</html>