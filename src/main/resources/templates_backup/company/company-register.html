<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>íŒë§¤ì ì „í™˜ - ìŠ¤ë§ˆíŠ¸í”½</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5" style="max-width: 500px;">
    <div class="card p-4 shadow-sm">
        <h3 class="fw-bold mb-4 text-center">ğŸ’¼ íŒë§¤ì(ì—…ì²´) ë“±ë¡</h3>
        <p class="text-center text-muted mb-4">
            ì‚¬ì—…ì ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œë©´<br>
            <strong>íŒë§¤ì íšŒì›</strong>ìœ¼ë¡œ ì¦‰ì‹œ ì „í™˜ë©ë‹ˆë‹¤.
        </p>

        <form action="/company/register" method="post">
            <div class="mb-3">
                <label class="form-label">ìƒí˜¸ëª…</label>
                <input type="text" name="businessName" class="form-control" placeholder="ìŠ¤ë§ˆíŠ¸ ì¤‘ê³ ì°¨" required>
            </div>

            <div class="mb-3">
                <label class="form-label">ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸</label>
                <div class="input-group">
                    <input type="text" id="businessNumber" name="businessNumber" class="form-control" placeholder="000-00-00000" required>
                    <button type="button" class="btn btn-outline-secondary" onclick="checkBusinessNumber()">ì¤‘ë³µ í™•ì¸</button>
                </div>
                <div id="businessFeedback" class="form-text"></div>
            </div>

            <div class="mb-3">
                <label class="form-label">ì‚¬ì—…ì¥ ì£¼ì†Œ</label>
                <input type="text" name="address" class="form-control" placeholder="ì„œìš¸ì‹œ ê°•ë‚¨êµ¬..." required>
            </div>

            <div class="d-grid gap-2 mt-4">
                <button type="submit" id="submitBtn" class="btn btn-dark fw-bold" disabled>íŒë§¤ìë¡œ ì „í™˜í•˜ê¸°</button>
                <a href="/mypage" class="btn btn-outline-secondary">ì·¨ì†Œ</a>
            </div>
        </form>
    </div>
</div>

<script>
    function checkBusinessNumber() {
        const businessInput = document.getElementById('businessNumber');
        const feedback = document.getElementById('businessFeedback');
        const submitBtn = document.getElementById('submitBtn');
        const number = businessInput.value;

        if (!number) {
            alert("ì‚¬ì—…ì ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        fetch('/api/check-business?number=' + number)
            .then(response => response.json())
            .then(isDuplicate => {
                if (isDuplicate) {
                    feedback.style.color = 'red';
                    feedback.textContent = "âŒ ì´ë¯¸ ë“±ë¡ëœ ì‚¬ì—…ì ë²ˆí˜¸ì…ë‹ˆë‹¤.";
                    submitBtn.disabled = true;
                    businessInput.classList.add('is-invalid');
                    businessInput.classList.remove('is-valid');
                } else {
                    feedback.style.color = 'green';
                    feedback.textContent = "âœ… ì‚¬ìš© ê°€ëŠ¥í•œ ì‚¬ì—…ì ë²ˆí˜¸ì…ë‹ˆë‹¤.";
                    submitBtn.disabled = false;
                    businessInput.classList.add('is-valid');
                    businessInput.classList.remove('is-invalid');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert("ê²€ì‚¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            });
    }

    document.getElementById('businessNumber').addEventListener('input', function() {
        const submitBtn = document.getElementById('submitBtn');
        const feedback = document.getElementById('businessFeedback');
        submitBtn.disabled = true;
        feedback.textContent = "";
        this.classList.remove('is-valid', 'is-invalid');
    });
</script>

</body>
</html>